---
apiVersion: scaffolder.backstage.io/v1beta3
kind: Template
metadata:
  name: http-request-parsing
  title: Http request parsing
  description: Example template to perform a jsonata expression on input data
spec:
  owner: roadie
  type: service

  parameters:
    - id: snyk-project-id
      title: Snyk Details
      properties:
        orgName:
          title: Org
          type: string
          description: The Snyk Org name or id
        projectId:
          title: Project id
          type: string
          description: The Snyk Project Id

  steps:
    - id: snyk-issues
      name: Snyk issues
      action: http:backstage:request
      input:
        method: 'GET'
        path: '/api/proxy/snyk/org/${{ parameters.orgName }}/projects'
    - id: parse
      name: Parse File
      action: roadiehq:utils:jsonata
      input:
        data: steps.snyk-issues.output.body
        expression: '$.projects.[name, id]'

  output:
    path: ${{ steps.serialize.output.result }}
    getResponse: '{{ steps.backstage_request.output.body }}'
    getCode: '{{ steps.backstage_request.output.code }}'
    getHeaders: '{{ steps.backstage_request.output.headers }}'